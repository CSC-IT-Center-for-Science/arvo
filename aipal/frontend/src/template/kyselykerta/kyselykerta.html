<h1 ng-if="!uusi">{{i18n.kyselykerta.hallitse}}</h1>
<h1 ng-if="uusi">{{i18n.kyselykerta.uusi_kyselykerta}}</h1>

<h2>{{i18n.yleiset.kysely}}: {{ kysely | lokalisoiKentta:'nimi' }}</h2>

<h3>{{i18n.kyselykerta.perustiedot}}</h3>

<form name="kyselykertaForm">
    <div class="row">
      <div class="col-md-4">
        <div class="form-group">
          <label for="kyselykerta_nimi" class="pakollinen">{{i18n.kyselykerta.kyselykerran_nimi}}</label>
          <input id="kyselykerta_nimi" type="text" ng-model="kyselykerta.nimi" class="form-control" ng-required="true" />
        </div>
      </div>
    </div>

    <div>
      <h3>{{i18n.kyselykerta.vastausaika}}</h3>
      <pvm-valitsin
              otsikko="{{i18n.yleiset.alkaen}}"
              oletus-pvm="kysely.voimassa_alkupvm"
              valittu-pvm="kyselykerta.voimassa_alkupvm"
              min-pvm="kysely.voimassa_alkupvm"
              max-pvm="kyselykerta.voimassa_loppupvm"
              ng-model="kyselykerta.voimassa_alkupvm"
              pakollinen="true">
      </pvm-valitsin>
      <pvm-valitsin
              otsikko="{{i18n.yleiset.asti}}"
              oletus-pvm="kyselykerta.voimassa_loppupvm"
              valittu-pvm="kyselykerta.voimassa_loppupvm"
              min-pvm="kyselykerta.voimassa_alkupvm"
              max-pvm="kysely.voimassa_loppupvm"
              ng-model="kyselykerta.voimassa_loppupvm"
              pakollinen="false">
      </pvm-valitsin>
    </div>
    <tallenna formi-validi="kyselykertaForm.$valid" ng-click="tallenna()" teksti="{{i18n.yleiset.tallenna}}" icon="glyphicon glyphicon-floppy-disk"></tallenna>
</form>

<div ng-if="!uusi">

<h3>{{i18n.vastaajatunnus.lista}}</h3>

<button class="btn btn-primary" ng-click="luoTunnuksiaDialogi()">
    {{i18n.vastaajatunnus.luonti}}&nbsp;&nbsp;
    <span class="glyphicon glyphicon-plus"></span>
</button>

<table class="table vastaajatunnus-taulukko">
  <thead>
    <tr>
      <th>{{'i18n.vastaajatunnus.tunnus'|i18n}}</th>
      <th>{{'i18n.vastaajatunnus.vastaajia'|i18n}}</th>
      <th>{{'i18n.vastaajatunnus.vastauksia'|i18n}}</th>
      <th>{{'i18n.yleiset.rahoitusmuoto'|i18n}}</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr ng-repeat="tunnus in tunnukset" ng-class="{lukittu: tunnus.lukittu, vanhentunut: !tunnus.kaytettavissa, voimassa: tunnus.kaytettavissa && tunnus.vastaajien_lkm > tunnus.vastausten_lkm}">
      <td>{{vastausBaseUrl}}/#/vastaus/{{tunnus.tunnus}}</td>
      <td>{{tunnus.vastaajien_lkm}}</td>
      <td>{{tunnus.vastausten_lkm}}</td>
      <td>{{rahoitusmuodotmap[tunnus.rahoitusmuotoid].rahoitusmuoto | enumArvo:'rahoitusmuoto'}}</td>
      <td>
        <span ng-if="tunnus.kaytettavissa && tunnus.vastaajien_lkm > tunnus.vastausten_lkm">
          <span ng-if="tunnus.lukittu" class="glyphicon glyphicon-lock" style="cursor: pointer" ng-click="lukitseTunnus(tunnus, false)"></span>
          <span ng-if="!tunnus.lukittu" class="glyphicon glyphicon-ok" style="cursor: pointer" ng-click="lukitseTunnus(tunnus, true)"></span>
        </span>
        &nbsp;
        <a href="mailto:?subject= {{i18n.vastaajatunnus.vastaa}}: {{ kysely | lokalisoiKentta:'nimi' }}&body={{vastausBaseUrl}}/#/vastaus/{{tunnus.tunnus}}" title="{{i18n.vastaajatunnus.laheta}}">
          <span class="glyphicon glyphicon-envelope"></span>
        </a>
      </td>
    </tr>
  </tbody>
</table>

</div>
