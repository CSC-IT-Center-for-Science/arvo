<h1 ng-if="!uusi">{{i18n.kyselykerta.hallitse}}</h1>
<h1 ng-if="uusi">{{i18n.kyselykerta.uusi_kyselykerta}}</h1>

<h2>Kysely: {{ kysely | lokalisoiKentta:'nimi' }}</h2>

<h3>Perustiedot</h3>

<form name="kyselykertaForm">

<div class="row">
  <div class="col-md-4">
    <div class="form-group">
      <label for="kyselykerta_nimi_fi" class="pakollinen">Kyselykerran nimi suomeksi</label>
      <input id="kyselykerta_nimi_fi" type="text" ng-model="kyselykerta.nimi_fi" class="form-control" ng-required="true" />
    </div>

    <div class="form-group">
      <label for="kyselykerta_nimi_sv">Kyselykerran nimi ruotsiksi</label>
      <input id="kyselykerta_nimi_sv" type="text" ng-model="kyselykerta.nimi_sv" class="form-control" />
    </div>
  </div>
</div>

<div>
  <pvm-valitsin
          otsikko="{{i18n.yleiset.alkaen}}"
          oletus-pvm="kyselykerta.voimassa_alkupvm"
          valittu-pvm="kyselykerta.voimassa_alkupvm"
          min-pvm="kysely.voimassa_alkupvm"
          max-pvm="kyselykerta.voimassa_loppupvm"
          ng-model="kyselykerta.voimassa_alkupvm"
          pakollinen="true">
  </pvm-valitsin>
  <pvm-valitsin
          otsikko="{{i18n.yleiset.asti}}"
          oletus-pvm="kyselykerta.voimassa_loppupvm"
          valittu-pvm="kyselykerta.voimassa_loppupvm"
          min-pvm="kyselykerta.voimassa_alkupvm"
          max-pvm="kysely.voimassa_loppupvm"
          ng-model="kyselykerta.voimassa_loppupvm"
          pakollinen="false">
  </pvm-valitsin>
</div>

</form>

<tallenna formi-validi="kyselykertaForm.$valid" ng-click="tallennaKyselykerta()" teksti="{{i18n.yleiset.tallenna}}"></tallenna>

<div ng-if="!uusi">

<h3>{{i18n.vastaajatunnus.lista}}</h3>

<button class="button button-with-icon add-icon-white" ng-click="luoTunnuksiaDialogi()">{{i18n.vastaajatunnus.luonti}}</button>

<table class="table vastaajatunnus-taulukko">
  <thead>
    <tr>
      <th>{{'i18n.vastaajatunnus.tunnus'|i18n}}</th>
      <th>{{'i18n.vastaajatunnus.vastausaika'|i18n}}</th>
      <th>{{'i18n.vastaajatunnus.vastaajia'|i18n}}</th>
      <th>{{'i18n.vastaajatunnus.vastauksia'|i18n}}</th>
      <th>{{'i18n.yleiset.rahoitusmuoto'|i18n}}</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr ng-repeat="tunnus in tunnukset" ng-class="{lukittu: tunnus.lukittu, vanhentunut: !tunnus.voimassa, voimassa: tunnus.voimassa && !tunnus.lukittu && tunnus.vastaajien_lkm > tunnus.vastausten_lkm}">
      <td>{{vastausBaseUrl}}/#/vastaus/{{tunnus.tunnus}}</td>
      <td class="vastausaika">{{tunnus.voimassa_alkupvm | voimassaoloAika: tunnus.voimassa_loppupvm}}</td>
      <td>{{tunnus.vastaajien_lkm}}</td>
      <td>{{tunnus.vastausten_lkm}}</td>
      <td>{{rahoitusmuodotmap[tunnus.rahoitusmuotoid].rahoitusmuoto | enumArvo:'rahoitusmuoto'}}</td>
      <td>
        <span ng-if="tunnus.voimassa && tunnus.vastaajien_lkm > tunnus.vastausten_lkm">
          <span ng-if="tunnus.lukittu" class="glyphicon glyphicon-lock" style="cursor: pointer" ng-click="lukitseTunnus(tunnus, false)"></span>
          <span ng-if="!tunnus.lukittu" class="glyphicon glyphicon-ok" style="cursor: pointer" ng-click="lukitseTunnus(tunnus, true)"></span>
        </span>
      </td>
    </tr>
  </tbody>
</table>

</div>