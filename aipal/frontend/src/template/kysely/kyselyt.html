<h1>{{i18n.kysely.otsikko}}</h1>

<fieldset class="luo-uusi-kysely" >
    <input type="text" class="icon search-icon-input" ng-model="hakuehto.teksti" placeholder="{{i18n.kysely.etsi}}">
    <auth-toiminto auth-nappi
        sallitut-roolit="['OPL-VASTUUKAYTTAJA','OPL-PAAKAYTTAJA']"
        class="btn btn-primary pull-right e2e-luo-uusi-kysely"
        ng-click="luoUusiKysely()"
        teksti="{{i18n.yleiset.luo_uusi_kysely}}"
        icon="glyphicon glyphicon-plus">
    </auth-toiminto>
</fieldset>

<div lataus-indikaattori metodi-id="kyselylistaus"
     viesti="{{i18n.yleiset.ladataan}}" virheviesti="{{i18n.yleiset.lataus_epaonnistui}}" yrita-uudelleen="haeKyselyt()"></div>

<accordion close-others="true" class="kyselyt">
    <accordion-group ng-repeat="kysely in kyselyt | filter:hakuehto.teksti | limitTo:50" is-open="group.open" ng-class="{'group-active': group.open}">

        <accordion-heading>
            <i class="pull-left icon" ng-class="{'contract-icon': group.open, 'expand-icon': !group.open}"></i>
            <h3 class="e2e-kysely-nimi">{{kysely | lokalisoiKentta:'nimi'}}</h3>
            <span class="text-muted">Voimassa: {{kysely.voimassa_alkupvm | voimassaoloAika: kysely.voimassa_loppupvm}}</span>
        </accordion-heading>

        <div class="panel-tools-content">
            <auth-toiminto auth-linkki
                linkki="#/kyselyt/kysely/{{kysely.kyselyid}}"
                sallitut-roolit="['OPL-VASTUUKAYTTAJA','OPL-PAAKAYTTAJA']"
                class="btn btn-primary pull-left"
                teksti="{{i18n.kysely.muokkaa}}"
                icon="glyphicon glyphicon-pencil">
            </auth-toiminto>
            <auth-toiminto auth-nappi
                sallitut-roolit="['OPL-VASTUUKAYTTAJA','OPL-PAAKAYTTAJA','OPL-KAYTTAJA']"
                class="btn btn-primary pull-left e2e-uusi-kyselykerta"
                ng-click="uusiKyselykerta(kysely)"
                teksti="{{i18n.kyselykerta.uusi_kyselykerta}}"
                icon="glyphicon glyphicon-plus">
            </auth-toiminto>
        </div>

        <div class="kyselykerrat">
            <div ng-show="kysely.kyselykerrat.length > 0" ng-repeat="kyselykerta in kysely.kyselykerrat" class="kyselykerrat-container">
                <h3 class="e2e-kyselykerta-nimi">{{i18n.yleiset.kyselykerta}}: {{kyselykerta | lokalisoiKentta:'nimi'}}</h3>
                <span class="text-muted">Voimassa: {{kyselykerta.voimassa_alkupvm | voimassaoloAika:  kyselykerta.voimassa_loppupvm}}</span>
                <auth-toiminto auth-linkki
                    linkki="#/kyselyt/{{kysely.kyselyid}}/kyselykerta/{{kyselykerta.kyselykertaid}}"
                    sallitut-roolit="['OPL-VASTUUKAYTTAJA','OPL-PAAKAYTTAJA','OPL-KAYTTAJA']"
                    teksti="{{i18n.kyselykerta.hallitse}}"
                    class="btn btn-primary btn-sm pull-left"
                    icon="glyphicon glyphicon-pencil">
                </auth-toiminto>
                <auth-toiminto auth-linkki
                    linkki="#/raportit/kyselykerrat/kyselykerta/{{kyselykerta.kyselykertaid}}"
                    sallitut-roolit="['OPL-VASTUUKAYTTAJA','OPL-PAAKAYTTAJA','OPL-KAYTTAJA','OPL-KATSELIJA']"
                    teksti="{{i18n.kysely.raportti}}"
                    class="btn btn-primary btn-sm pull-left"
                    icon="glyphicon glyphicon-stats">
                </auth-toiminto>
            </div>
        </div>
        <span ng-show="!kysely.kyselykerrat.length" class="text-muted">{{i18n.kysely.ei_kyselykertoja}}</span>
    </accordion-group>
</accordion>
