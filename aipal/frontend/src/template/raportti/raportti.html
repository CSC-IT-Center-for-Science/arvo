<div class="alert alert-danger" ng-if="tulos.virheelliset.length > 0">
  {{'raportit.liian_vahan_vastaajia' | i18n}}
  <ul>
    <li ng-repeat="raportti in tulos.virheelliset">
      {{raportti | lokalisoiKentta:'nimi'}}
    </li>
  </ul>
</div>

<div ng-show="tulos" class="hidden-print print-header">
  <h1>{{ 'kysely.raportti_otsikko' | i18n }}</h1>
  <div class="clearfix">
    <button class="btn btn-primary" onclick="window.print()">{{ 'kysely.raportti_tulosta' | i18n }}&nbsp;<span class="fa fa-print"></span></button>
    <div class="checkbox">
      <label>
        <input type="checkbox" ng-model="printgraphs">&nbsp;{{ 'kysely.raportti_tulosta_graafit' | i18n }}
      </label><br />
      <label>
        <input type="checkbox" ng-model="printfreetext">&nbsp;{{ 'kysely.raportti_tulosta_vapaatekstivastaukset' | i18n }}
      </label>
    </div>
  </div>
</div>

<div class="raportti-kyselykerta-tiedot" ng-if="tulos">
  <div>
    <h2>{{tulos | lokalisoiKentta:'nimi'}}</h2>
  </div>
  <div ng-show="tulos.yhteenveto.kysely_fi">
    {{'yleiset.kysely' | i18n }}: <b>{{tulos.yhteenveto | lokalisoiKentta:'kysely'}}</b>
  </div>
  <div ng-show="tulos.yhteenveto.kyselykerta">
    {{'yleiset.kyselykerta' | i18n }}: <b class="e2e-yhteenveto-kyselykerta">{{tulos.yhteenveto.kyselykerta}}</b>
  </div>
  <div class="hidden-print" ng-show="tulos.luontipvm">
    {{'raportti.raportin_luontipaiva' | i18n }}: <b class="e2e-luontipvm">{{tulos.luontipvm | date: 'dd.MM.yyyy'}}</b>
  </div>
  <div ng-show="tulos.parametrit.vertailujakso_alkupvm || tulos.parametrit.vertailujakso_loppupvm">
    <span ng-show="raportti.tyyppi=='kyselykerta' || raportti.tyyppi=='kysely'">{{'raportit.raportin_aikajakso' | i18n }}:</span>
    <span ng-show="raportti.tyyppi!='kyselykerta' && raportti.tyyppi!='kysely'Â ">{{'raportti.raportin_vertailujakso' | i18n }}:</span>
    <b>{{tulos.parametrit.vertailujakso_alkupvm | date: 'dd.MM.yyyy'}} - {{tulos.parametrit.vertailujakso_loppupvm | date: 'dd.MM.yyyy'}}</b>
  </div>

  <div ng-if="tulos.yhteenveto">
    <hr class="hidden-print">
    <div ng-repeat="koulutustoimija in tulos.yhteenveto.koulutustoimijat">
      <div>
        <h3>{{'raportti.koulutuksen_jarjestaja' | i18n}}: <span>{{koulutustoimija | lokalisoiKentta:'koulutustoimija'}}</span></h3>
      </div>
      <table class="table">
        <thead>
          <tr>
            <th>{{'yleiset.tutkinto' | i18n}}</th>
            <th>{{'yleiset.vastaajia' | i18n}}</th>
          </tr>
        </thead>
        <tbody>
          <tr ng-repeat="tutkinto in koulutustoimija.tutkinnot">
            <td ng-if="tutkinto.tutkintotunnus">{{tutkinto.tutkintotunnus}}, {{tutkinto | lokalisoiKentta:'nimi'}}</td>
            <td ng-if="!tutkinto.tutkintotunnus">{{'raportti.ei_tutkintotietoa' | i18n}}</td>
            <td>{{tutkinto.vastaajien_lukumaara}}</td>
          </tr>
          <tr>
            <td>{{'raportti.yhteensa' | i18n }}</td>
            <td>{{koulutustoimija.vastaajien_lukumaara}}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<table class="report-table">
    <thead>
        <tr>
            <th></th>
            <th ng-repeat="i in raporttiIndeksit">{{ tulos.nimet[i] | lokalisoiKentta:'nimi' }}</th>
        </tr>
    </thead>
    <tfoot style="text-align: center">
        <tr>
            <td>{{'raportti.kokonaismaara' | i18n }}</td>
            <td ng-repeat="i in raporttiIndeksit">{{ tulos.vastaajien_lukumaara[i] }}</td>
        </tr>
        <tr>
            <td>{{'raportti.kohderyhman_koko' | i18n }}</td>
            <td ng-repeat="i in raporttiIndeksit">{{ tulos.vastaajien_maksimimaara[i] }}</td>
        </tr>
        <tr>
            <td>{{'raportti.vastausprosentti' | i18n }}</td>
            <td ng-repeat="i in raporttiIndeksit">{{ prosenttiosuus(tulos.vastaajien_lukumaara[i], tulos.vastaajien_maksimimaara[i]) }} %</td>
        </tr>
    </tfoot>
</table>

<div ng-repeat="kysymysryhma in tulos.raportti" class="kysymysryhma">
  <h2>{{kysymysryhma | lokalisoiKentta:'nimi'}}</h2>

  <table class="report-table">
    <thead>
      <tr>
        <th></th>
        <th ng-repeat="i in raporttiIndeksit">{{ tulos.nimet[i] | lokalisoiKentta:'nimi' }}</th>
      </tr>
    </thead>
    <tfoot style="text-align: center">
      <tr>
        <td>{{'raportti.vastaajien_maara' | i18n }}</td>
        <td ng-repeat="i in raporttiIndeksit">{{ kysymysryhma.vastaajien_lukumaara[i] }}/{{ kysymysryhma.vastaajien_maksimimaara[i] }}</td>
      </tr>
      <tr>
        <td>{{'raportti.vastausprosentti' | i18n }}</td>
        <td ng-repeat="i in raporttiIndeksit">{{ prosenttiosuus(kysymysryhma.vastaajien_lukumaara[i], kysymysryhma.vastaajien_maksimimaara[i]) }}%</td>
      </tr>
    </tfoot>
  </table>

  <div ng-repeat="kysymys in kysymysryhma.kysymykset" class="kysymys e2e-kysymysryhma-kysymykset-repeat">
    <h3 class="e2e-kysymys-otsikko">{{kysymys.jarjestys}}. {{kysymys | lokalisoiKentta:'kysymys'}}</h3>

    <jakauma-kaavio ng-class="{ 'hidden-print': !printgraphs }"
      ng-if="kysymys.vastaustyyppi === 'kylla_ei_valinta' || kysymys.vastaustyyppi === 'monivalinta'"
      jakauma="kysymys.jakauma" vastaustyyppi="kysymys.vastaustyyppi" nimet="tulos.nimet">
    </jakauma-kaavio>

    <vaittama-kaavio ng-class="{ 'hidden-print': !printgraphs }"
      ng-if="kysymys.vastaustyyppi === 'asteikko' || kysymys.vastaustyyppi === 'likert_asteikko' || kysymys.vastaustyyppi === 'arvosana'"
      jakauma="kysymys.jakauma" vastaustyyppi="kysymys.vastaustyyppi" nimet="tulos.nimet"
      eos="kysymys.eos_vastaus_sallittu">
    </vaittama-kaavio>

    <table class="report-table" ng-if="kysymys.vastaustyyppi && kysymys.vastaustyyppi !== 'vapaateksti'">
      <thead>
        <tr>
          <th class="report-table-question"></th>
          <th ng-repeat="i in raporttiIndeksit" colspan="2" class="report-table-percentage-field">{{ tulos.nimet[i] | lokalisoiKentta:'nimi' }}</th>
        </tr>
        <tr>
          <th class="report-table-question e2e-kysymys-taulukossa">{{kysymys | lokalisoiKentta:'kysymys'}}</th>
          <th ng-repeat-start="i in raporttiIndeksit" class="report-table-percentage-field">Vast%</th>
          <th ng-repeat-end class="report-table-amount-header">n={{lukumaaratYhteensa(kysymys.jakauma, i)}}</th>
        </tr>
      </thead>
      <tbody>
        <tr ng-repeat="alkio in kysymys.jakauma">
          <td class="e2e-vaihtoehto" ng-if="kysymys.vastaustyyppi !== 'monivalinta'">{{'kysymys.' + kysymys.vastaustyyppi + '.' + alkio['vaihtoehto-avain'] | i18n}}</td>
          <td class="e2e-vaihtoehto" ng-if="kysymys.vastaustyyppi === 'monivalinta'">
            <span ng-if="alkio.jarjestys === 'eos'">{{'kysymys.monivalinta.eos' | i18n}}</span>
            <span ng-if="alkio.jarjestys !== 'eos'">{{alkio | lokalisoiKentta:'vaihtoehto' }}</span>
          </td>
          <td ng-repeat-start="i in raporttiIndeksit" class="report-table-percentage-field e2e-osuus">{{alkio.osuus[i]}}%</td>
          <td ng-repeat-end class="report-table-amount-field e2e-vastausten-lukumaara">{{alkio.lukumaara[i]}}</td>
        </tr>
      </tbody>
      <tfoot style="text-align: center">
        <tr ng-if="kysymys.keskiarvo !== undefined">
          <td>{{ 'raportti.keskiarvo' | i18n }}</td>
          <td ng-repeat="i in raporttiIndeksit" colspan="2">{{ kysymys.keskiarvo[i] | number:2 }}</td>
        </tr>
        <tr ng-if="kysymys.keskihajonta !== undefined">
          <td>{{ 'raportti.keskihajonta' | i18n }}</td>
          <td ng-repeat="i in raporttiIndeksit" colspan="2">{{ kysymys.keskihajonta[i] | number:2 }}</td>
        </tr>
        <tr>
          <td>{{'raportti.vastaajien_maara' | i18n }}</td>
          <td ng-repeat="i in raporttiIndeksit" colspan="2">{{ kysymys.vastaajien_lukumaara[i] }}/{{ kysymysryhma.vastaajien_maksimimaara[i] }}</td>
        </tr>
        <tr>
          <td>{{'raportti.vastausprosentti' | i18n }}</td>
          <td ng-repeat="i in raporttiIndeksit" colspan="2">{{ prosenttiosuus(kysymys.vastaajien_lukumaara[i], kysymysryhma.vastaajien_maksimimaara[i]) }}%</td>
        </tr>
      </tfoot>
    </table>

    <div class="jatkokysymykset" ng-if="kysymys.jatkovastaukset">
      <h3>{{$index + 1}}. {{i18n.raportit.jatkokysymykset}}</h3>
      <div class="kylla-jatkokysymys" ng-if="kysymys.jatkovastaukset.kylla">
        <h4>{{kysymys.jatkovastaukset.kylla | lokalisoiKentta:'kysymys'}}</h4>
        <vaittama-kaavio ng-class="{ 'hidden-print': !printgraphs }"
          ng-if="kysymys.jatkovastaukset.kylla.vastaustyyppi === 'asteikko'"
          jakauma="kysymys.jatkovastaukset.kylla.jakauma"
          vastaustyyppi="kysymys.jatkovastaukset.kylla.vastaustyyppi"
          nimet="tulos.nimet">
        </vaittama-kaavio>
      </div>
      <div class="ei-jatkokysymys" ng-if="kysymys.jatkovastaukset.ei">
        <h4>{{kysymys.jatkovastaukset.ei | lokalisoiKentta:'kysymys'}}</h4>
        <table class="report-table">
          <thead>
            <tr><th>{{'raportti.vastaukset' |i18n}}:</th></tr>
          </thead>
          <tbody>
            <tr ng-repeat="vastaus in kysymys.jatkovastaukset.ei.vapaatekstivastaukset">
              <td ng-repeat="i in raporttiIndeksit"><span class="whitespace">{{vastaus.teksti[i]}}</span></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div ng-if="kysymys.vastaustyyppi === 'vapaateksti' && !printfreetext" class="visible-print">({{'raportti.ei_tulostettu' | i18n }})</div>

    <table ng-class="{ 'hidden-print': !printfreetext }" class="report-table" ng-show="kysymys.vastaustyyppi === 'vapaateksti'">
      <thead>
        <tr><th>{{'raportti.vastaukset' |i18n}}:</th></tr>
      </thead>
      <tbody>
        <tr ng-repeat="vastaus in kysymys.vapaatekstivastaukset" class="e2e-kysymys-vapaatekstivastaukset-repeat">
          <td ng-repeat="i in raporttiIndeksit"><span class="whitespace">{{vastaus.teksti[i]}}</span></td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
